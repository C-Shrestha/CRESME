@model IEnumerable<CRESME.Data.ApplicationUser>
﻿@{

    ViewData["Title"] = "Create CRESME";
    IEnumerable<string> UniqueCourses = Model.Select(x => x.Course).Distinct().Where(x => x != null);
    IEnumerable<string> UniqueTerms = Model.Select(x => x.Term).Distinct().Where(x => x != null);
}


@if (TempData["AlertMessage"] != null)
{
    <div aria-live="polite" aria-atomic="true" style="position: relative; min-height: 0px;">
        <div class="toast bg-success" style="position: absolute; top: 0; right: 0;" data-delay="2000">
            <div class="toast-body">
                @(TempData["AlertMessage"])
            </div>
        </div>
    </div>

}




<form id="Form1" asp-controller="Quiz" asp-action="Create" method="post" enctype="multipart/form-data">
    <div class="d-flex align-items-center min-vh-100">
        <div class="container border bg-white rounded" style="width: 50%;">
            <div class="row gx-5 justify-content-center gy-2">

                <div class="w-100"></div>
                <h4 class="col-6 text-center" style="font-weight: bold;">Create CRESME Form</h4>

                <div class="w-100"></div>
                <div class="col-10" style="height: 5px; background-color: #f1c400;"></div>

                <div class="w-100"></div>
                <input class="col-4  input-field" type="text" name="QuizName" placeholder="Enter CRESME Name" required>

                <div class="w-100"></div>

                <input class="col-4  input-field" type="text" name="PatientIntro" placeholder="Enter Patient Intro" required>
                <div class="w-100"></div>

                <input type="datetime-local" class="col-5" id="startDate" name="StartDate" runat="server" required>
                <div class="col-1">-</div>
                <input type="datetime-local" class="col-5" id="endDate" name="EndDate" runat="server" required>
                <div class="w-100"></div>

                <div class="col-2" style="font-weight: bold;">Publish</div>
                <input class="col-1" type="checkbox" id="publish" name="Publish" value="1">
                <div class="w-100"></div>

                <div class="col-2" style="font-weight: bold;">Feedback</div>
                <input class="col-1" type="checkbox" id="feedback" name="Feedback" value="1">
                <div class="w-100"></div>

                <div class="col-4" style="font-weight: bold;">Number of Columns:</div>

                <div class="form-check form-check-inline col-1">
                    <input class="form-check-input" type="radio" name="NumColumns" id="NumColumns1" value="4">
                    <label class="form-check-label" for="NumColumns">4</label>
                </div>
                <div class="form-check form-check-inline col-1">
                    <input class="form-check-input" type="radio" name="NumColumns" id="NumColumns2" value="5">
                    <label class="form-check-label" for="NumColumns">5</label>
                </div>
                <div class="w-100"></div>

                <button type="button" id="imageButton" class="col-4 btn btn-link" onclick="addImage()">+Image to Table Cell</button>
                <div class="w-100"></div>

                <div class="col-4 text-center" style="font-weight: bold;">Upload Legend Image</div>
                <div class="w-100"></div>

                <input type="file" name="Legend" id="Legend" accept=".jpg, .jpeg" style="display: none;" required />
                <label class="col-4 row justify-content-center border" id="legendLabel" for="Legend" style="border-color: black !important;">
                    <i class="text-center fa-solid fa-flag"></i>
                </label>
                <div class="w-100"></div>

                <div class="col-4 text-center" style="font-weight: bold;">Upload Excel File</div>
                <div class="w-100"></div>


                <input type="file" name="ExcelFileUpload" id="excelButton" accept=".xlsx" style="display: none;" required />
                <label class="col-4 row justify-content-center border" id="excelLabel" for="excelButton" style="border-color: black !important;">
                    <i class="text-center fa-sharp fa-solid fa-upload"></i>
                </label>
                <div class="w-100"></div>

                <select id="Term" name="Term" class="form-select col-3" aria-label="Default select example" style="text-align-last: center; width:25%; height: 15%" required>
                    <option value="none" selected>Term</option>
                    <option value="none">N\A</option>
                    @foreach (var term in UniqueTerms)
                    {
                        <option value=@term>@term</option>
                    }
                </select>
                <div class="col-1"></div>

                <select id="Block" name="Block" class="form-select col-3" multiple aria-label="Default select example" style="text-align-last: center; width:25%;" required>
                    <option value="none" selected>Block</option>
                    <option value="none">N\A</option>
                    <option value="B1">1</option>
                    <option value="B2">2</option>
                    <option value="B3">3</option>
                    <option value="B4">4</option>
                    <option value="B5">5</option>
                    <option value="B6">6</option>
                    <option value="B7">7</option>
                    <option value="B8">8</option>
                    <option value="B9">9</option>
                    <option value="B10">10</option>
                    <option value="B11">11</option>
                    <option value="B12">12</option>
                </select>
                <div class="col-1"></div>

                <select id="Course" name="Course" class="form-select col-3" aria-label="Default select example" style="text-align-last: center; width:25%; height: 15%" required>
                    <option value="none" selected>Courses</option>
                    <option value="none">N\A</option>
                    @foreach (var course in UniqueCourses)
                    {
                        <option value=@course>@course</option>
                    }
                </select>
                <div class="w-100"></div>

                <button type="submit" class="btn custom_btn col-5">Create CRESME</button>
                <div class="w-100"></div>

            </div>
        </div>
    </div>
</form>



<style>
    .container {
        border-color: #F1C400 !important;
        border-radius: 20px !important;
    }

    .custom_btn {
        background-color: #F1C400;
        font-weight: bold;
    }

    .upload-btn {
        border-color: #F1C400 !important;
        background: transparent;
    }

    .input-field {
        border-color: black;
    }

    label {
        background-color: white;
        padding: 0.5rem;
        border-color: #F1C400 !important;
        cursor: pointer;
    }

</style>



<script>

    var i = 0;



    function deleteButton(k) {
        var deleteButton = document.getElementById(k);
        var inputButton = document.getElementById('imageFile' + k);
        var inputLabel = document.getElementById('imageLabel' + k);
        var list = document.getElementById('ImagePos' + k);
        var vrDiv = document.getElementById('vrDiv' + k);
        var hrDiv1 = document.getElementById('hrDiv1' + k);
        var hrDiv2 = document.getElementById('hrDiv2' + k);
        var altText = document.getElementById('altText' + k);
        var checkMark = document.getElementById('imgCheckMark' + k);
        var imageName = document.getElementById('imageName' + k);
        var break1 = document.getElementById('newBreak1' + k);
        var break2 = document.getElementById('newBreak2' + k);
        var vrDiv1 = document.getElementById('vrDiv1' + k);
        

        deleteButton.remove();
        inputButton.remove();
        inputLabel.remove();
        list.remove();
        vrDiv.remove();
        hrDiv1.remove();
        hrDiv2.remove();
        altText.remove();
        vrDiv1.remove();

        if (checkMark != null) {

            checkMark.remove();
            imageName.remove();
            break1.remove();
            break2.remove();

        }


        i--;
    }

    function addImage() {

        if(i <10){
        var deleteButton = document.createElement("button");
        deleteButton.setAttribute("class", 'custom_btn col-2');
        deleteButton.setAttribute("onclick", 'deleteButton(this.id)');
        deleteButton.setAttribute("id", '' + i);
        deleteButton.innerHTML = "Delete";


        var newDiv = document.createElement("div");
        newDiv.setAttribute("class", 'w-100');
        newDiv.setAttribute("id", 'vrDiv' + i);


        var hrDiv1 = document.createElement("div");
        hrDiv1.setAttribute("class", 'col-1');
        hrDiv1.setAttribute("id", 'hrDiv1' + i);

        var hrDiv2 = document.createElement("div");
        hrDiv2.setAttribute("class", 'col-1');
        hrDiv2.setAttribute("id", 'hrDiv2' + i);


        var imageButton = document.getElementById("imageButton");

        var newfile = document.createElement("input");
        newfile.setAttribute("type", 'file');
        newfile.setAttribute("name", 'imageFile' + i);
        newfile.setAttribute("id", 'imageFile' + i);
        newfile.setAttribute("accept", '.jpg, .jpeg');
        newfile.setAttribute("onchange", 'checkForImage(this.id)');
        newfile.style.display = "none";


        imageButton.after(newDiv);
        newDiv.after(deleteButton);
        deleteButton.after(hrDiv1);
        hrDiv1.after(newfile);
        newfile.after(hrDiv2);

        var select = document.createElement("select");
        select.setAttribute("class", 'form-select col-1');
        select.setAttribute("aria-label", 'Default select example');
        select.setAttribute("id", 'ImagePos' + i);
        select.setAttribute("name", 'ImagePos' + i);
        select.style.width = "15%";
        select.style.height = "10%";
        select.style.textAlignLast = "center"

        const options = ["A", "B", "C", "D", "E", "1", "2", "3", "4", "5"];

        options.forEach((element, key) => {
            select[key] = new Option(element, key);
            select[key].setAttribute("value", element);
            select[key].setAttribute("name", 'Image' + key + 'Pos');
        });

        hrDiv2.after(select);
        imageButton.after(newDiv);

        var altText = document.createElement("input");
        altText.setAttribute("class", 'col-6  input-field');
        altText.setAttribute("type", 'text');
        altText.setAttribute("name", 'Image' + i + 'Alt');
        altText.setAttribute("id", 'altText' + i);
        altText.setAttribute("placeholder", 'Enter Alt Text');


        var newlabel = document.createElement("Label");
        newlabel.setAttribute("class", 'col-4 row justify-content-center border');
        newlabel.setAttribute("for", 'imageFile' + i);
        newlabel.setAttribute("id", 'imageLabel' + i);
        newlabel.style.setProperty("border-color", "black", "important");

        newi = document.createElement("i");
            newi.setAttribute("class", "text-center fa-solid fa-image");
        newlabel.appendChild(newi);

        imageButton.after(newDiv);
        newfile.after(newlabel);

        var newDiv1 = document.createElement("div");
        newDiv1.setAttribute("class", 'w-100');
        newDiv1.setAttribute("id", 'vrDiv1' + i);

        select.after(newDiv1);
        newDiv1.after(altText);


            i++;
        }

    }

    function checkForImage(id) {


        var imageButton = document.getElementById(id);

        if (imageButton.value != "") {

            var char = id.slice(-1);
            var j = parseInt(char);

            var checkForI = document.getElementById("imgCheckMark" + j);

            if (checkForI == null) {

                var newi = document.createElement("i");
                newi.setAttribute("class", "col-1 fa-solid fa-check");
                newi.setAttribute("id", "imgCheckMark" + j);

                var newBreak = document.createElement("div");
                newBreak.setAttribute("class", 'w-100');
                newBreak.setAttribute("id", 'newBreak1' + j);

                document.getElementById("ImagePos" + j).after(newi);
                document.getElementById("altText" + j).after(newBreak);

                var newdiv = document.createElement("div");
                newdiv.setAttribute("class", "col-12 text-center");
                newdiv.setAttribute("id", 'imageName' + j);
                newdiv.style.fontWeight = "bold";
                newdiv.innerHTML = imageButton.value.split("\\").pop();


                newBreak.after(newdiv);

                var newBreak1 = document.createElement("div");
                newBreak1.setAttribute("class", 'w-100');
                newBreak1.setAttribute("id", 'newBreak2' + j);

                newdiv.after(newBreak1)
            }
            else
            {
                var newdiv = document.getElementById("imageName" + j);
                newdiv.innerHTML = imageButton.value.split("\\").pop();

            }


        }
    }

    var fileButton = document.getElementById("excelButton");
    var legendButton = document.getElementById("Legend");


    legendButton.onchange = function () {

    var checkForI = document.getElementById("legendCheckMark");

    if ((legendButton.value) != "" && (checkForI == null)) 
    {

        var newi = document.createElement("i");
        newi.setAttribute("class", "col-1 fa-solid fa-check");
        newi.setAttribute("id", "legendCheckMark");

        var newBreak = document.createElement("div");
        newBreak.setAttribute("class", 'w-100');

        document.getElementById("legendLabel").after(newi);
        newi.after(newBreak);

        var newdiv = document.createElement("div");
        newdiv.setAttribute("class", "col-6 text-center");
        newdiv.setAttribute("id", "legendName");
        newdiv.style.fontWeight = "bold";
        newdiv.innerHTML = legendButton.value.substr(legendButton.value.lastIndexOf('\\') + 1).split('.')[0];

        newBreak.after(newdiv);

        var newBreak1 = document.createElement("div");
        newBreak1.setAttribute("class", 'w-100');

        newdiv.after(newBreak1);

    }
    else if (checkForI != null) {

        var newdiv = document.getElementById("legendName");
        newdiv.innerHTML = legendButton.value.substr(legendButton.value.lastIndexOf('\\') + 1).split('.')[0];

    }

}
    



    fileButton.onchange = function () {

    var checkForI = document.getElementById("excelCheckMark");

    if ((fileButton.value) != "" && (checkForI == null)) 
    {

        var newi = document.createElement("i");
        newi.setAttribute("class", "col-1 fa-solid fa-check");
        newi.setAttribute("id", "excelCheckMark");

        var newBreak = document.createElement("div");
        newBreak.setAttribute("class", 'w-100');

        document.getElementById("excelLabel").after(newi);
        newi.after(newBreak);

        var newdiv = document.createElement("div");
        newdiv.setAttribute("class", "col-6 text-center");
        newdiv.setAttribute("id", "excelFileName");
        newdiv.style.fontWeight = "bold";
        newdiv.innerHTML = fileButton.value.substr(fileButton.value.lastIndexOf('\\') + 1).split('.')[0];

        newBreak.after(newdiv);

        var newBreak1 = document.createElement("div");
        newBreak1.setAttribute("class", 'w-100');

        newdiv.after(newBreak1);

    }
    else if (checkForI != null)
    {
        var newdiv = document.getElementById("excelFileName");
        newdiv.innerHTML = fileButton.value.substr(fileButton.value.lastIndexOf('\\') + 1).split('.')[0];

    }


    }



</script>
<script>

    window.onload = function () {
        // your code here
        $('.toast').toast('show');
    };
</script>